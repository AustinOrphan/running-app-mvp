#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-push checks..."

# Check code coverage
echo "ğŸ“Š Checking code coverage..."
npm run coverage:enforce

if [ $? -ne 0 ]; then
  echo "âŒ Code coverage is below 80% threshold!"
  echo ""
  echo "Please improve test coverage before pushing:"
  echo "  â€¢ Run 'npm run coverage:analyze' to identify gaps"
  echo "  â€¢ Add tests for uncovered code"
  echo "  â€¢ Run 'npm run coverage:watch' while adding tests"
  echo ""
  echo "Push blocked due to insufficient coverage."
  exit 1
fi

echo "âœ… Code coverage check passed!"

# Run lint check
echo "ğŸ§¹ Running lint check..."
npm run lint:check

if [ $? -ne 0 ]; then
  echo "âŒ Lint check failed!"
  echo "Run 'npm run lint:fix' to fix issues"
  exit 1
fi

echo "âœ… All pre-push checks passed!"